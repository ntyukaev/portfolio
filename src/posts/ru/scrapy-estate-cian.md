---
title: Автоматический сбор данных о квартирах с сайта cian.ru
preview: scrapy-estate-cian.jpg
---

Исходный код можно найти [здесь](https://github.com/ntyukaev/cian-webcrawler)
Это приложение создано для сбора данных о недвижимости с [cian.ru](https://cian.ru) using [Scrapy](https://scrapy.org/).

## Требования

- Python 3.10
- Node js

## Установка

Перейдите в папку проекта и установите зависимости Python:

```sh
pip install -r requirements.txt
```

## Как использовать?

Приложение хранит данные в базе данных, а также уведомляет вас по электронной почте.
Перед использованием приложения вы должны указать следующие переменные среды:

- **USER_AGENT**: Заголовок запроса. Для получения дополнительной информации см. [официальную документацию](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent). Пример значения: **Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36**.
- **CONNECTION_STRING**: Строка подключения к базе данных. Больше информации [здесь](https://en.wikipedia.org/wiki/Connection_string). Пример: **sqlite:///flats.sqlite**.
- **MAIL_HOST**: Имя хоста почтового сервера.
- **MAIL_PASS**: Пароль почтового сервера.
- **MAIL_USER**: Отправитель письма.
- **MAIL_PORT**: Порт почтового сервера.
- **MAIL_RECIPIENT**: Получатель письма.

Для настройки сервера электронной почты вы можете использовать gmail.com. [Эта статья](https://kinsta.com/blog/gmail-smtp-server/) описывает шаги по настройке smtp-сервера gmail.

После настройки переменных среды перейдите в папку проекта и выполните следующую команду:

```sh
scrapy crawl cian \
-a location=<location string> \
-a minprice=<min price in rubles> \
-a maxprice=<max price in rubles>
```

## Список аргументов

Паук имеет следующие аргументы (все аргументы передаются через **-a name=val**):

- **location**: (Обязательно) Реальный адрес, который идентифицирует местоположение.
- **minprice**: (Обязательно) Минимальная цена на объекты недвижимости.
- **maxprice**: (Обязательно) Максимальная цена на объекты недвижимости.
- **zoom**: (Необязательно. По умолчанию **0,001**) Переменная, используемая для создания полигона местоположения (см. [estate/spiders/cian.py](estate/spiders/cian.py)).
  Чем больше значение **zoom**, тем больше полигон локации.
- **step**: (Необязательно. По умолчанию **0,001**) Переменная, используемая для разделения полигона местоположения на несколько полигонов. Чем больше сгенерированных полигонов, тем больше результатов вы получите.
- **room1**: (Необязательно. По умолчанию **1**) Если установлено **1**, включают однокомнатные квартиры, иначе **0**.
- **room2**: (Необязательно. По умолчанию **0**) Если установлено **1**, включают двухкомнатные квартиры, иначе **0**.
- **room3**: (Необязательно. По умолчанию **0**) Если установлено **1**, включают трехкомнатные квартиры, иначе **0**.
- **room4**: (Необязательно. По умолчанию **0**) Если установлено **1**, включают четырехкомнатные квартиры, иначе **0**.
